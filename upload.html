<!doctype html>
<html lang="fr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>File Upload</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Space+Mono:wght@400;700&family=Syne:wght@400;600;800&display=swap"
      rel="stylesheet"
    />
    <style>
      *,
      *::before,
      *::after {
        box-sizing: border-box;
        margin: 0;
        padding: 0;
      }

      :root {
        --bg: #0a0a0f;
        --surface: #13131a;
        --border: #2a2a3d;
        --accent: #6c63ff;
        --accent2: #ff6584;
        --text: #e8e8f0;
        --muted: #6b6b8a;
        --success: #3ddc97;
        --error: #ff4f6a;
        --radius: 16px;

        --card-padding: clamp(20px, 5vw, 40px);
        --gap-lg: clamp(20px, 4vw, 32px);
        --gap-md: clamp(12px, 3vw, 20px);
        --gap-sm: clamp(8px, 2vw, 16px);
        --font-h1: clamp(20px, 5vw, 28px);
        --font-body: clamp(12px, 2.5vw, 15px);
        --font-mono: clamp(10px, 2vw, 11px);
        --drop-padding: clamp(24px, 5vw, 40px) clamp(16px, 4vw, 24px);
      }

      html {
        -webkit-text-size-adjust: 100%;
      }

      body {
        background: var(--bg);
        color: var(--text);
        font-family: "Syne", sans-serif;
        min-height: 100vh;
        min-height: 100dvh;
        display: flex;
        align-items: center;
        justify-content: center;
        padding: clamp(12px, 4vw, 24px);
      }

      body::before {
        content: "";
        position: fixed;
        inset: 0;
        background:
          radial-gradient(
            ellipse 60% 50% at 20% 20%,
            rgba(108, 99, 255, 0.12) 0%,
            transparent 70%
          ),
          radial-gradient(
            ellipse 40% 40% at 80% 80%,
            rgba(255, 101, 132, 0.08) 0%,
            transparent 60%
          );
        pointer-events: none;
        z-index: 0;
      }

      .card {
        position: relative;
        z-index: 1;
        background: var(--surface);
        border: 1px solid var(--border);
        border-radius: clamp(16px, 4vw, 24px);
        padding: var(--card-padding);
        width: 100%;
        max-width: 480px;
        box-shadow:
          0 32px 80px rgba(0, 0, 0, 0.5),
          0 0 0 1px rgba(108, 99, 255, 0.1);
      }

      .card-header {
        margin-bottom: var(--gap-lg);
      }

      .badge {
        display: inline-flex;
        align-items: center;
        gap: 6px;
        background: rgba(108, 99, 255, 0.15);
        border: 1px solid rgba(108, 99, 255, 0.3);
        color: #a89cff;
        font-family: "Space Mono", monospace;
        font-size: var(--font-mono);
        padding: 4px 12px;
        border-radius: 100px;
        margin-bottom: var(--gap-sm);
        letter-spacing: 0.05em;
      }

      .badge::before {
        content: "";
        width: 6px;
        height: 6px;
        background: var(--accent);
        border-radius: 50%;
        animation: pulse 2s infinite;
        flex-shrink: 0;
      }

      @keyframes pulse {
        0%,
        100% {
          opacity: 1;
          transform: scale(1);
        }
        50% {
          opacity: 0.4;
          transform: scale(0.8);
        }
      }

      h1 {
        font-size: var(--font-h1);
        font-weight: 800;
        color: var(--text);
        line-height: 1.2;
      }

      h1 span {
        color: var(--accent);
      }

      .subtitle {
        color: var(--muted);
        font-size: clamp(11px, 2.5vw, 14px);
        margin-top: 6px;
        font-family: "Space Mono", monospace;
      }

      /* Drop zone */
      .drop-zone {
        border: 2px dashed var(--border);
        border-radius: var(--radius);
        padding: var(--drop-padding);
        text-align: center;
        cursor: pointer;
        transition: all 0.25s ease;
        position: relative;
        overflow: hidden;
        background: rgba(255, 255, 255, 0.02);
        -webkit-tap-highlight-color: transparent;
        touch-action: manipulation;
      }

      .drop-zone:hover,
      .drop-zone.drag-over {
        border-color: var(--accent);
        background: rgba(108, 99, 255, 0.06);
        transform: scale(1.01);
      }

      .drop-zone:active {
        transform: scale(0.99);
      }

      .drop-zone input[type="file"] {
        position: absolute;
        inset: 0;
        opacity: 0;
        cursor: pointer;
        width: 100%;
        height: 100%;
        font-size: 16px; /* prevents iOS zoom */
      }

      .drop-icon {
        width: clamp(44px, 10vw, 56px);
        height: clamp(44px, 10vw, 56px);
        background: rgba(108, 99, 255, 0.15);
        border-radius: 14px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin: 0 auto var(--gap-sm);
        font-size: clamp(20px, 5vw, 24px);
        transition: transform 0.3s ease;
      }

      .drop-zone:hover .drop-icon {
        transform: translateY(-4px);
      }

      .drop-title {
        font-weight: 600;
        font-size: var(--font-body);
        color: var(--text);
        margin-bottom: 4px;
      }

      .drop-subtitle {
        font-family: "Space Mono", monospace;
        font-size: var(--font-mono);
        color: var(--muted);
      }

      @media (hover: none) {
        .drop-subtitle .desktop {
          display: none;
        }
        .drop-subtitle .mobile {
          display: inline;
        }
      }
      @media (hover: hover) {
        .drop-subtitle .desktop {
          display: inline;
        }
        .drop-subtitle .mobile {
          display: none;
        }
      }

      .drop-formats {
        display: flex;
        justify-content: center;
        gap: 6px;
        margin-top: var(--gap-sm);
        flex-wrap: wrap;
      }

      .format-tag {
        background: rgba(255, 255, 255, 0.05);
        border: 1px solid var(--border);
        color: var(--muted);
        font-family: "Space Mono", monospace;
        font-size: clamp(9px, 2vw, 10px);
        padding: 3px 7px;
        border-radius: 6px;
      }

      /* File preview */
      .file-preview {
        display: none;
        align-items: center;
        gap: clamp(8px, 3vw, 12px);
        background: rgba(108, 99, 255, 0.08);
        border: 1px solid rgba(108, 99, 255, 0.2);
        border-radius: 12px;
        padding: clamp(10px, 3vw, 14px) clamp(12px, 3vw, 16px);
        margin-top: var(--gap-md);
      }

      .file-preview.visible {
        display: flex;
      }

      .file-icon {
        width: clamp(34px, 8vw, 40px);
        height: clamp(34px, 8vw, 40px);
        border-radius: 10px;
        background: rgba(108, 99, 255, 0.2);
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: clamp(15px, 4vw, 18px);
        flex-shrink: 0;
      }

      .file-info {
        flex: 1;
        min-width: 0;
      }

      .file-name {
        font-size: clamp(11px, 2.5vw, 13px);
        font-weight: 600;
        color: var(--text);
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
      }

      .file-size {
        font-family: "Space Mono", monospace;
        font-size: var(--font-mono);
        color: var(--muted);
        margin-top: 2px;
      }

      /* Button */
      .btn-upload {
        width: 100%;
        margin-top: var(--gap-md);
        padding: clamp(12px, 3.5vw, 15px);
        background: var(--accent);
        color: white;
        border: none;
        border-radius: var(--radius);
        font-family: "Syne", sans-serif;
        font-size: var(--font-body);
        font-weight: 700;
        cursor: pointer;
        transition: all 0.25s ease;
        position: relative;
        overflow: hidden;
        letter-spacing: 0.03em;
        touch-action: manipulation;
        -webkit-tap-highlight-color: transparent;
        min-height: 48px;
      }

      .btn-upload::before {
        content: "";
        position: absolute;
        inset: 0;
        background: linear-gradient(
          135deg,
          rgba(255, 255, 255, 0.15),
          transparent
        );
        opacity: 0;
        transition: opacity 0.25s;
      }

      .btn-upload:hover:not(:disabled)::before {
        opacity: 1;
      }
      .btn-upload:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 12px 32px rgba(108, 99, 255, 0.4);
      }
      .btn-upload:active:not(:disabled) {
        transform: translateY(1px);
      }
      .btn-upload:disabled {
        opacity: 0.5;
        cursor: not-allowed;
      }

      /* Progress */
      .progress-wrap {
        display: none;
        margin-top: var(--gap-md);
      }
      .progress-wrap.visible {
        display: block;
      }

      .progress-label {
        display: flex;
        justify-content: space-between;
        font-family: "Space Mono", monospace;
        font-size: var(--font-mono);
        color: var(--muted);
        margin-bottom: 8px;
      }

      .progress-bar {
        height: 6px;
        background: var(--border);
        border-radius: 100px;
        overflow: hidden;
      }

      .progress-fill {
        height: 100%;
        background: linear-gradient(90deg, var(--accent), var(--accent2));
        border-radius: 100px;
        width: 0%;
        transition: width 0.3s ease;
        position: relative;
      }

      .progress-fill::after {
        content: "";
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        width: 40px;
        background: linear-gradient(
          90deg,
          transparent,
          rgba(255, 255, 255, 0.4)
        );
        animation: shimmer 1s infinite;
      }

      @keyframes shimmer {
        0% {
          opacity: 0;
        }
        50% {
          opacity: 1;
        }
        100% {
          opacity: 0;
        }
      }

      /* Status */
      .status {
        display: none;
        margin-top: var(--gap-md);
        padding: clamp(10px, 3vw, 14px) clamp(12px, 3vw, 16px);
        border-radius: 12px;
        font-size: clamp(11px, 2.5vw, 13px);
        align-items: flex-start;
        gap: 10px;
      }

      .status.visible {
        display: flex;
      }

      .status.success {
        background: rgba(61, 220, 151, 0.1);
        border: 1px solid rgba(61, 220, 151, 0.25);
        color: var(--success);
      }

      .status.error {
        background: rgba(255, 79, 106, 0.1);
        border: 1px solid rgba(255, 79, 106, 0.25);
        color: var(--error);
      }

      .status-icon {
        font-size: 16px;
        flex-shrink: 0;
        margin-top: 1px;
      }
      .status-body {
        flex: 1;
        min-width: 0;
      }
      .status-title {
        font-weight: 700;
        margin-bottom: 4px;
      }

      .url-box {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(0, 0, 0, 0.3);
        border: 1px solid rgba(61, 220, 151, 0.2);
        border-radius: 8px;
        padding: 8px 10px;
        margin-top: 8px;
        flex-wrap: wrap;
      }

      .url-text {
        font-family: "Space Mono", monospace;
        font-size: var(--font-mono);
        color: var(--success);
        flex: 1;
        min-width: 0;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-decoration: none;
      }

      .btn-copy {
        background: none;
        border: 1px solid rgba(61, 220, 151, 0.3);
        color: var(--success);
        border-radius: 6px;
        padding: 5px 10px;
        font-family: "Space Mono", monospace;
        font-size: var(--font-mono);
        cursor: pointer;
        transition: all 0.2s;
        flex-shrink: 0;
        min-height: 32px;
        touch-action: manipulation;
      }

      .btn-copy:hover {
        background: rgba(61, 220, 151, 0.1);
      }

      .btn-reset {
        display: none;
        width: 100%;
        margin-top: var(--gap-sm);
        padding: clamp(10px, 3vw, 12px);
        background: transparent;
        border: 1px solid var(--border);
        color: var(--muted);
        border-radius: 10px;
        font-family: "Syne", sans-serif;
        font-size: clamp(12px, 2.5vw, 13px);
        cursor: pointer;
        transition: all 0.2s;
        min-height: 44px;
        touch-action: manipulation;
      }

      .btn-reset:hover {
        border-color: var(--muted);
        color: var(--text);
      }
      .btn-reset.visible {
        display: block;
      }

      /* Extra small */
      @media (max-width: 360px) {
        .drop-formats {
          gap: 4px;
        }
        .format-tag {
          padding: 2px 5px;
        }
        h1 {
          font-size: 18px;
        }
      }

      /* Landscape mobile */
      @media (max-height: 500px) and (orientation: landscape) {
        body {
          align-items: flex-start;
          padding-top: 12px;
          padding-bottom: 12px;
        }
        .card {
          max-width: 560px;
        }
        .card-header {
          margin-bottom: 16px;
        }
        .drop-zone {
          padding: 16px;
        }
        .drop-icon {
          width: 36px;
          height: 36px;
          font-size: 18px;
          margin-bottom: 8px;
        }
      }
    </style>
  </head>
  <body>
    <div class="card">
      <div class="card-header">
        <div class="badge">FTP Upload</div>
        <h1>Upload <span>fichier</span></h1>
        <p class="subtitle">‚Üí images &amp; vid√©os / shared hosting</p>
      </div>

      <div class="drop-zone" id="dropZone">
        <input type="file" id="fileInput" accept="image/*,video/*" />
        <div class="drop-icon">üìÅ</div>
        <div class="drop-title">Glisse ton fichier ici</div>
        <div class="drop-subtitle">
          <span class="desktop">ou clique pour parcourir</span>
          <span class="mobile">Appuie pour parcourir</span>
        </div>
        <div class="drop-formats">
          <span class="format-tag">JPG</span>
          <span class="format-tag">PNG</span>
          <span class="format-tag">WEBP</span>
          <span class="format-tag">MP4</span>
          <span class="format-tag">MOV</span>
        </div>
      </div>

      <div class="file-preview" id="filePreview">
        <div class="file-icon" id="fileIcon">üìÑ</div>
        <div class="file-info">
          <div class="file-name" id="fileName">‚Äî</div>
          <div class="file-size" id="fileSize">‚Äî</div>
        </div>
      </div>

      <button
        class="btn-upload"
        id="btnUpload"
        disabled
        onclick="handleUpload()"
      >
        Uploader le fichier ‚Üí
      </button>

      <div class="progress-wrap" id="progressWrap">
        <div class="progress-label">
          <span id="progressLabel">Upload en cours...</span>
          <span id="progressPct">0%</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" id="progressFill"></div>
        </div>
      </div>

      <div class="status success" id="statusSuccess">
        <div class="status-icon">‚úÖ</div>
        <div class="status-body">
          <div class="status-title">Upload r√©ussi !</div>
          <div class="url-box">
            <a class="url-text" id="urlText" href="#" target="_blank">‚Äî</a>
            <button class="btn-copy" onclick="copyUrl()">Copier</button>
          </div>
        </div>
      </div>

      <div class="status error" id="statusError">
        <div class="status-icon">‚ùå</div>
        <div class="status-body">
          <div class="status-title">Erreur</div>
          <div id="errorMsg">‚Äî</div>
        </div>
      </div>

      <button class="btn-reset" id="btnReset" onclick="resetForm()">
        ‚Ü∫ Uploader un autre fichier
      </button>
    </div>

    <script>
      const BACKEND_URL = "http://localhost:3001";

      const fileInput = document.getElementById("fileInput");
      const dropZone = document.getElementById("dropZone");
      const filePreview = document.getElementById("filePreview");
      const fileIcon = document.getElementById("fileIcon");
      const fileName = document.getElementById("fileName");
      const fileSize = document.getElementById("fileSize");
      const btnUpload = document.getElementById("btnUpload");
      const progressWrap = document.getElementById("progressWrap");
      const progressFill = document.getElementById("progressFill");
      const progressLabel = document.getElementById("progressLabel");
      const progressPct = document.getElementById("progressPct");
      const statusSuccess = document.getElementById("statusSuccess");
      const statusError = document.getElementById("statusError");
      const urlText = document.getElementById("urlText");
      const errorMsg = document.getElementById("errorMsg");
      const btnReset = document.getElementById("btnReset");

      let selectedFile = null;

      fileInput.addEventListener("change", () => {
        if (fileInput.files[0]) setFile(fileInput.files[0]);
      });

      function setFile(file) {
        selectedFile = file;
        const isImage = file.type.startsWith("image/");
        const isVideo = file.type.startsWith("video/");
        fileIcon.textContent = isImage ? "üñºÔ∏è" : isVideo ? "üé¨" : "üìÑ";
        fileName.textContent = file.name;
        fileSize.textContent = formatSize(file.size);
        filePreview.classList.add("visible");
        btnUpload.disabled = false;
        hideAll();
      }

      dropZone.addEventListener("dragover", (e) => {
        e.preventDefault();
        dropZone.classList.add("drag-over");
      });

      dropZone.addEventListener("dragleave", () =>
        dropZone.classList.remove("drag-over"),
      );

      dropZone.addEventListener("drop", (e) => {
        e.preventDefault();
        dropZone.classList.remove("drag-over");
        const file = e.dataTransfer.files[0];
        if (file) setFile(file);
      });

      async function handleUpload() {
        if (!selectedFile) return;
        btnUpload.disabled = true;
        hideAll();
        showProgress(0);

        const formData = new FormData();
        formData.append("file", selectedFile);

        let fakeProgress = 0;
        const interval = setInterval(() => {
          fakeProgress = Math.min(fakeProgress + Math.random() * 15, 88);
          showProgress(Math.round(fakeProgress));
        }, 200);

        try {
          const res = await fetch(`${BACKEND_URL}/api/upload`, {
            method: "POST",
            body: formData,
          });

          clearInterval(interval);
          showProgress(100);

          const data = await res.json();
          if (!res.ok) throw new Error(data.error || "Erreur inconnue");

          setTimeout(() => {
            progressWrap.classList.remove("visible");
            showSuccess(data.url);
            btnReset.classList.add("visible");
          }, 400);
        } catch (err) {
          clearInterval(interval);
          progressWrap.classList.remove("visible");
          showError(err.message);
          btnUpload.disabled = false;
        }
      }

      function showProgress(pct) {
        progressWrap.classList.add("visible");
        progressFill.style.width = pct + "%";
        progressPct.textContent = pct + "%";
        progressLabel.textContent =
          pct < 100 ? "Upload en cours..." : "Finalisation...";
      }

      function showSuccess(url) {
        statusSuccess.classList.add("visible");
        urlText.href = url;
        urlText.textContent = url;
      }

      function showError(msg) {
        statusError.classList.add("visible");
        errorMsg.textContent = msg;
      }

      function hideAll() {
        statusSuccess.classList.remove("visible");
        statusError.classList.remove("visible");
        progressWrap.classList.remove("visible");
        btnReset.classList.remove("visible");
      }

      function resetForm() {
        selectedFile = null;
        fileInput.value = "";
        filePreview.classList.remove("visible");
        btnUpload.disabled = true;
        hideAll();
      }

      function copyUrl() {
        navigator.clipboard.writeText(urlText.href).then(() => {
          const btn = document.querySelector(".btn-copy");
          btn.textContent = "‚úì Copi√©";
          setTimeout(() => (btn.textContent = "Copier"), 2000);
        });
      }

      function formatSize(bytes) {
        if (bytes < 1024) return bytes + " B";
        if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + " KB";
        return (bytes / (1024 * 1024)).toFixed(1) + " MB";
      }
    </script>
  </body>
</html>
